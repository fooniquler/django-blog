{% extends 'base.html' %}

{% block title %}
    Edit post
{% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        {% if user.pk == post.author.id %}
            <div class="form-group">
                <form method="POST">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <div>
                        <form action="{% url 'post_view' post.pk %}">
                            {% csrf_token %}
                            <button class="btn btn-outline-primary ">Back</button>
                        </form>

                        <button class="btn btn-outline-primary">Submit changes</button>
                    </div>
                </form>
            </div>
        {% else %}

            <form action="{% url 'home' %}" class="mt-5 text-center" >
                {% csrf_token %}
                <button class="btn btn-outline-primary ">Go back to home page</button>
            </form>

            <div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3">
                <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-warning text-dark">
                      <strong class="me-auto">Error!</strong>
                      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                      You can only change your posts
                    </div>
                </div>
            </div>

            <script type="text/javascript">
                const elem = document.getElementById('liveToast');
                const toast = bootstrap.Toast.getOrCreateInstance(elem);
                toast.show();

                elem.addEventListener('hidden.bs.toast', function (){
                    window.location.href = '/';
                })
            </script>
        {% endif %}

    {% else %}

        <form action="{% url 'login' %}" class="mt-5 text-center" >
                {% csrf_token %}
                <button class="btn btn-outline-primary ">Go to login page</button>
            </form>

            <div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3">
                <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header bg-warning text-dark">
                      <strong class="me-auto">Error!</strong>
                      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                      You must be logged in to edit posts
                    </div>
                </div>
            </div>

            <script type="text/javascript">
                const elem = document.getElementById('liveToast');
                const toast = bootstrap.Toast.getOrCreateInstance(elem);
                toast.show();

                elem.addEventListener('hidden.bs.toast', function (){
                    window.location.href = '/signup/login';
                })
            </script>

    {% endif %}


{% endblock %}
